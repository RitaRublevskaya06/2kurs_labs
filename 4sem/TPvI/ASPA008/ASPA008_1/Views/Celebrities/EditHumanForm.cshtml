@using ASPA008_1;
@using ASPA008_1.Controllers
@using DAL_Celebrity_MSSQL
@using Microsoft.AspNetCore.Mvc.Rendering;
@inject CelebritiesAPI.CountryCodes Countries;
@{
    Layout = "_CelebritiesLayout";
    Celebrity? c = (Celebrity?)(ViewData["Celebrity"] ?? null);
    SelectList slcountries = new SelectList(Countries, "code", "countryLabel", c.Nationality);
    bool Confirm = (bool)(ViewData["Confirm"] ?? false);
}
<div class="editdiv" style="height: 350px">
    <div class="celebrity-box img">
        <img id="previewImage" src="@($"{Model}/{c.ReqPhotoPath}")" class="celebrity-photo" style="height:300px; width:auto;" />
    </div>
    <div class="celebrity-box form_c">
        @using (Html.BeginForm("UpdateCelebrity", "Celebrities", FormMethod.Post, new { enctype = "multipart/form-data", id = "updateForm" }))
        {
            <input type="hidden" name="id" value="@c.Id" />
            <input type="hidden" name="_method" value="put" />
            <input type="hidden" name="currentPhotoPath" value="@c.ReqPhotoPath" />
            <div class="row">
                @Html.TextBox("fullname", c.FullName, new { @class = "col-8" })
                @Html.DropDownList("Nationality", slcountries, new { @class = "col-4" })
            </div>
            <div class="row">
                <input id="upload" name="upload" type="file" style="display: none;" accept="image/jpeg" onchange="onChange(this)" />
                <button class="col-12" id="butupload" type="button" onclick="document.getElementById('upload').click()">Change photo (@c.ReqPhotoPath)</button>
            </div>
            <div class="row">
                <button class="col-6" type="submit">OK</button>
                <button class="col-6" type="button" onclick="location.href='/@c.Id'">CANCEL</button>
            </div>
        }
    </div>
</div>
<script>
    function onChange(input) {
        const button = document.getElementById('butupload');
        const preview = document.getElementById('previewImage');

        if (input.files && input.files[0]) {
            const file = input.files[0];
            button.textContent = file.name;
            const reader = new FileReader();
            reader.onload = function (e) {
                preview.src = e.target.result;
            }
            reader.readAsDataURL(file);
        } else {
            button.textContent = "@c.ReqPhotoPath";
            preview.src = "@($"{Model}/{c.ReqPhotoPath}")";
        }
    }
</script>